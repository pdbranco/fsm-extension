<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Push Event</title>
    <link href="styles.css" rel="stylesheet">
  </head>
  <body>
    <div>
      <h2 id="info"></h2>
    </div>
    <div id="contentContainer">
      <button id="createNewPushEvent">Create New Push Event</button>
      <div class="search-style-group">
        <svg viewBox="0 0 24 24" aria-hidden="true" class="search-style-icon">
          <g>
            <path
              d="M21.53 20.47l-3.66-3.66C19.195 15.24 20 13.214 20 11c0-4.97-4.03-9-9-9s-9 4.03-9 9 4.03 9 9 9c2.215 0 4.24-.804 5.808-2.13l3.66 3.66c.147.146.34.22.53.22s.385-.073.53-.22c.295-.293.295-.767.002-1.06zM3.5 11c0-4.135 3.365-7.5 7.5-7.5s7.5 3.365 7.5 7.5-3.365 7.5-7.5 7.5-7.5-3.365-7.5-7.5z"
            ></path>
          </g>
        </svg>
        <input type="text" id="searchInput" class="search-style" placeholder="Search Push Events">
      </div>
    </div>
    <p id="noPermissionLabel" style="display: none; color: red;">You don't have the necessary permissions to access this content.</p>
    <br><br>
    <script src="https://unpkg.com/fsm-shell"></script>
    <script src="helpersPushEvent.js"></script>
    <script>
      const { ShellSdk, SHELL_EVENTS } = FSMShell;

      if (!ShellSdk.isInsideShell()) {
        updateUI('Unable to reach shell eventAPI');
      } else {
        const shellSdk = ShellSdk.init(parent, '*');

        shellSdk.emit(SHELL_EVENTS.Version1.REQUIRE_CONTEXT, {
          clientIdentifier: 'push-event',
          auth: {
            response_type: 'token'
          }
        });

        shellSdk.on(SHELL_EVENTS.Version1.REQUIRE_CONTEXT, (event) => {
          const {
            cloudHost,
            account,
            company,
            user,
            auth
          } = JSON.parse(event);

          initializeRefreshTokenStrategy(shellSdk, auth);

          let allowExtension = false;
          shellSdk.emit(SHELL_EVENTS.Version3.GET_PERMISSIONS, {objectName: 'UdoMeta'});
          shellSdk.on(SHELL_EVENTS.Version3.GET_PERMISSIONS, (response) => {
            allowExtension = response.permission.CREATE && response.permission.UPDATE && response.permission.DELETE;
            console.log("Imprimir permiss√£o: ", allowExtension);

            if (allowExtension) {
              // Show content and hide no permission label
              document.getElementById('contentContainer').style.display = 'block';
              document.getElementById('noPermissionLabel').style.display = 'none';

              getPushEvents(cloudHost, account, company);

              const searchInput = document.getElementById('searchInput');
              searchInput.addEventListener('keyup', filterTable);

              const createNewPushEventButton = document.getElementById('createNewPushEvent');
              createNewPushEventButton.addEventListener('click', function() {
                window.location.href = "detailsPushEvent.html?id=new";
              });
            } else {
              // Hide content and show no permission label
              document.getElementById('contentContainer').style.display = 'none';
              document.getElementById('noPermissionLabel').style.display = 'block';
            }
          });
        });
      }
    </script>
  </body>
</html>
